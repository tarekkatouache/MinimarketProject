generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model app_settings {
  id          Int       @id @default(autoincrement())
  key         String    @unique(map: "sqlite_autoindex_app_settings_1")
  value       String?
  type        String?
  description String?
  created_at  DateTime? @default(now())
  updated_at  DateTime? @default(now())
}

model categories {
  id         Int        @id @default(autoincrement())
  name       String
  created_at DateTime?  @default(now())
  products   products[]
}

model expenses {
  id             Int       @id @default(autoincrement())
  title          String
  amount         Decimal
  category       String?
  payment_method String?
  note           String?
  user_id        Int?
  created_at     DateTime? @default(now())
  user          user?    @relation(fields: [user_id], references: [id], onUpdate: NoAction)
}

model payments {
  id         Int       @id @default(autoincrement())
  sale_id    Int
  method     PaymentMethod  @default(CASH)
  amount     Decimal
  reference  String?
  status     PaymentStatus   @default(CONFIRMED)
  created_at DateTime? @default(now())
  sales      sales     @relation(fields: [sale_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model products {
  id              Int               @id @default(autoincrement())
  name            String
  barcode         String?         @unique(map: "sqlite_autoindex_products_1")
  category_id     Int?
  supplier_id     Int?
  purchase_price  Decimal
  selling_price   Decimal
  stock_quantity  Int?              @default(0)
  min_stock_alert Int?              @default(5)
  unit            String?           @default("PCS")
  is_active       Boolean?          @default(true)
  created_at      DateTime?         @default(now())
  updated_at      DateTime?         @updatedAt
  suppliers       suppliers?        @relation(fields: [supplier_id], references: [id], onUpdate: NoAction)
  categories      categories?       @relation(fields: [category_id], references: [id], onUpdate: NoAction)
  sale_items      sale_items[]
  stock_movements stock_movements[]

   @@index([category_id])
  @@index([is_active])
  @@index([barcode])
}

model sale_items {
  id          Int      @id @default(autoincrement())
  sale_id     Int
  product_id  Int
  quantity    Int
  unit_price  Decimal
  total_price Decimal
  products    products @relation(fields: [product_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  sales       sales    @relation(fields: [sale_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model sales {
  id             Int          @id @default(autoincrement())
  receipt_number String       @unique(map: "sqlite_autoindex_sales_1")
  total_amount   Decimal
  net_amount     Decimal?
  discount       Decimal?     @default(0)
  payment_method PaymentMethod @default(CASH)
  payment_status PaymentStatus @default(CONFIRMED)
  cashier_id     Int?
  created_at     DateTime?    @default(now())
  payments       payments[]
  sale_items     sale_items[]
  user         user?       @relation(fields: [cashier_id], references: [id], onUpdate: NoAction)

   @@index([created_at])
  @@index([cashier_id])
  @@index([payment_status])
}

model stock_movements {
  id            Int       @id @default(autoincrement())
  product_id    Int
  movement_type StockMovementType
  quantity      Int
  reason        String?
  user_id       Int?
  created_at    DateTime? @default(now())
  user         user?    @relation(fields: [user_id], references: [id], onUpdate: NoAction)
  products      products  @relation(fields: [product_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
}

model suppliers {
  id         Int        @id @default(autoincrement())
  name       String
  phone      String?
  address    String?
  email      String?
  created_at DateTime?  @default(now())
  products   products[]
}

model user {
  id              Int               @id @default(autoincrement())
  first_name      String
  last_name       String?
  username        String            @unique(map: "sqlite_autoindex_user_1")
  password_hash   String
  role            Role              @default(CASHIER)
  is_active       Boolean?          @default(true)
  created_at      DateTime?         @default(now())
  expenses        expenses[]
  sales           sales[]
  stock_movements stock_movements[]
  last_login    DateTime?
  email         String?   @unique
  phone         String?
  updated_at    DateTime? @updatedAt

   @@index([role])
  @@index([is_active])
}
model scan_logs {
  id         Int       @id @default(autoincrement())
  barcode    String
  product_id Int?
  user_id    Int?
  created_at DateTime? @default(now())
  products   products? @relation(fields: [product_id], references: [id])
  user       user?     @relation(fields: [user_id], references: [id])
}

enum Role {
  ADMIN
  MANAGER
  CASHIER
}
enum PaymentMethod {
  CASH
  CARD
  TRANSFER
  EWALLET
}
enum PaymentStatus {
  CONFIRMED
  PENDING
  PAID
  PARTIAL
  REFUNDED
}
enum StockMovementType {
  PURCHASE
  SALE
  ADJUSTMENT
  RETURN
  DAMAGED
}


